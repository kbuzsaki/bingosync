{% load bootstrap %}
{% load app_filters %}

<div id="new-card-dialog" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Generate New Card</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="new-card-form">
                    {{ new_card_form|bootstrap_horizontal:"col-md-3" }}
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="generate-new-card">Generate Card</button>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        var newCardUrl = "{% url 'new_card' %}";
        $('#generate-new-card').on('click', function() {
            var formData = $("#new-card-form").serializeArray();
            var data = {"hide_card": 0};
            formData.forEach(function (input) {
                if (input['name'] === 'hide_card') {
                    data['hide_card'] = input['value'] === 'on';
                } else {
                    data[input['name']] = input['value'];
                }
            });
            data.room = window.sessionStorage.getItem("room");
            $.ajax({
                "url": newCardUrl,
                "type": "PUT",
                "data": JSON.stringify(data),
                "success": function () {
                    $("#new-card-dialog").modal("hide");
                    // TODO update room settings panel
                    // oh, I guess also the initial values in the new card form too
                },
                "error": function(result) {
                    console.log(result);
                }
            });
        });
    });
</script>
